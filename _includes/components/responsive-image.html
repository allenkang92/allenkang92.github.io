{% comment %}
반응형 이미지 컴포넌트
사용법: {% include components/responsive-image.html src="/path/to/image.jpg" alt="이미지 설명" %}
옵션:
- src: 이미지 경로 (필수)
- alt: 대체 텍스트 (필수)
- lazy: 지연 로딩 여부 (기본값: true)
- class: 추가 클래스 (선택 사항)
- caption: 이미지 캡션 (선택 사항)
{% endcomment %}

{% assign lazy_load = include.lazy | default: true %}
{% assign img_class = include.class | default: "img-fluid" %}
{% if lazy_load %}
  {% assign img_class = img_class | append: " lazy" %}
{% endif %}

<figure class="responsive-figure {{ include.figure_class }}">
  <picture>
    {% if include.webp != false %}
      {% assign webp_src = include.src | replace: '.jpg', '.webp' | replace: '.jpeg', '.webp' | replace: '.png', '.webp' %}
      <!-- WebP 형식 지원 - 최신 브라우저에서 성능 최적화 -->
      <source 
        {% if lazy_load %}data-srcset{% else %}srcset{% endif %}="
          {{ webp_src | replace: '.webp', '-400.webp' | relative_url }} 400w,
          {{ webp_src | replace: '.webp', '-800.webp' | relative_url }} 800w,
          {{ webp_src | relative_url }} 1200w
        "
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
        type="image/webp">
    {% endif %}
    
    <!-- 기본 이미지 형식 - 호환성 보장 -->
    <img 
      {% if lazy_load %}
        src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E"
        data-src="{{ include.src | relative_url }}"
        data-srcset="
          {{ include.src | replace: '.jpg', '-400.jpg' | replace: '.jpeg', '-400.jpeg' | replace: '.png', '-400.png' | relative_url }} 400w,
          {{ include.src | replace: '.jpg', '-800.jpg' | replace: '.jpeg', '-800.jpeg' | replace: '.png', '-800.png' | relative_url }} 800w,
          {{ include.src | relative_url }} 1200w
        "
      {% else %}
        src="{{ include.src | relative_url }}"
        srcset="
          {{ include.src | replace: '.jpg', '-400.jpg' | replace: '.jpeg', '-400.jpeg' | replace: '.png', '-400.png' | relative_url }} 400w,
          {{ include.src | replace: '.jpg', '-800.jpg' | replace: '.jpeg', '-800.jpeg' | replace: '.png', '-800.png' | relative_url }} 800w,
          {{ include.src | relative_url }} 1200w
        "
      {% endif %}
      alt="{{ include.alt }}"
      class="{{ img_class }}"
      loading="{% if lazy_load %}lazy{% else %}eager{% endif %}"
      decoding="async"
      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      width="{{ include.width | default: 'auto' }}"
      height="{{ include.height | default: 'auto' }}">
  </picture>
  
  {% if include.caption %}
  <figcaption>{{ include.caption }}</figcaption>
  {% endif %}
</figure>
